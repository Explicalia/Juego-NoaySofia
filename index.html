<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#667eea">
<title>Sof√≠a y Noa - Aprende Jugando</title>
<link rel="apple-touch-icon" href="icon.jpg">
<link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Patrick+Hand&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">

<style>
:root {
  --primary: #FFD700;
  --secondary: #FF4500;
  --accent: #00E676;
  --blue: #4FC3F7;
  --pink: #FF80AB;
  --purple: #B388FF;
  --bg-grad: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  --bg-menu: linear-gradient(135deg, #74ebd5 0%, #ACB6E5 100%);
  --font-fun: 'Fredoka One', cursive;
  --safe-top: env(safe-area-inset-top, 0px);
  --safe-bottom: env(safe-area-inset-bottom, 0px);
  --safe-left: env(safe-area-inset-left, 0px);
  --safe-right: env(safe-area-inset-right, 0px);
}

* { 
  box-sizing: border-box; 
  margin: 0; 
  padding: 0; 
  user-select: none; 
  -webkit-tap-highlight-color: transparent;
  -webkit-touch-callout: none;
}

html {
  overflow: hidden;
  position: fixed;
  width: 100%;
  height: 100%;
}

body {
  font-family: 'Quicksand', sans-serif;
  overflow: hidden;
  height: 100dvh;
  height: 100vh;
  width: 100vw;
  background: var(--bg-grad);
  padding-top: var(--safe-top);
  padding-bottom: var(--safe-bottom);
  padding-left: var(--safe-left);
  padding-right: var(--safe-right);
  overscroll-behavior: none;
  touch-action: manipulation;
}

/* --- PART√çCULAS DE FONDO --- */
#bgParticles { position: absolute; inset: 0; pointer-events: none; z-index: 0; overflow: hidden; }
.particle { 
  position: absolute; 
  border-radius: 50%; 
  animation: float linear infinite;
  opacity: 0.6;
}
@keyframes float { 
  from { transform: translateY(100vh) rotate(0deg); opacity: 0; } 
  50% { opacity: 0.6; } 
  to { transform: translateY(-10vh) rotate(360deg); opacity: 0; } 
}

/* --- PANTALLAS --- */
.screen {
  position: absolute; 
  inset: 0; 
  display: none; 
  flex-direction: column; 
  align-items: center; 
  justify-content: center; 
  z-index: 10; 
  padding: 15px;
  padding-top: calc(15px + var(--safe-top));
  padding-bottom: calc(15px + var(--safe-bottom));
}
.screen.active { display: flex; animation: fadeIn 0.5s ease-out; }
@keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }

/* ========================================
   PANTALLA 1: PORTADA
   ======================================== */
#portada {
  background: linear-gradient(180deg, #87CEEB 0%, #98D8C8 50%, #7EC8E3 100%);
  padding: 0;
  justify-content: flex-start;
}

.portada-container {
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  position: relative;
}

.portada-image {
  width: 100%;
  max-width: 500px;
  height: auto;
  max-height: 85vh;
  object-fit: contain;
  border-radius: 0;
  animation: floatImage 3s ease-in-out infinite;
}

@keyframes floatImage {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-10px); }
}

.play-btn-portada {
  position: absolute;
  bottom: 8%;
  left: 50%;
  transform: translateX(-50%);
  background: linear-gradient(135deg, #4FC3F7 0%, #29B6F6 100%);
  color: white;
  padding: 18px 50px;
  font-family: var(--font-fun);
  font-size: clamp(1.2rem, 5vw, 1.8rem);
  border-radius: 50px;
  border: 4px solid white;
  box-shadow: 0 8px 25px rgba(0,0,0,0.3), 0 4px 0 #0288D1;
  cursor: pointer;
  animation: pulse 1.5s ease-in-out infinite;
  display: flex;
  align-items: center;
  gap: 10px;
  min-height: 60px;
  z-index: 20;
}

.play-btn-portada:active {
  transform: translateX(-50%) scale(0.95);
  box-shadow: 0 4px 15px rgba(0,0,0,0.3), 0 2px 0 #0288D1;
}

@keyframes pulse {
  0%, 100% { transform: translateX(-50%) scale(1); }
  50% { transform: translateX(-50%) scale(1.05); }
}

/* ========================================
   PANTALLA 2: MEN√ö DE JUEGOS
   ======================================== */
#menu {
  background: var(--bg-menu);
  gap: 15px;
  padding-top: calc(20px + var(--safe-top));
}

.menu-header {
  text-align: center;
  margin-bottom: 10px;
}

.menu-title {
  font-family: var(--font-fun);
  font-size: clamp(1.8rem, 7vw, 2.8rem);
  color: white;
  text-shadow: 3px 3px 0 var(--secondary), -1px -1px 0 #333;
  margin-bottom: 5px;
}

.menu-subtitle {
  font-family: 'Patrick Hand', cursive;
  font-size: clamp(1rem, 4vw, 1.4rem);
  color: rgba(255,255,255,0.9);
}

.games-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
  gap: 15px;
  width: 100%;
  max-width: 500px;
  padding: 10px;
}

.game-card {
  background: white;
  border-radius: 25px;
  padding: 20px 15px;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 10px;
  cursor: pointer;
  transition: transform 0.3s, box-shadow 0.3s;
  box-shadow: 0 8px 20px rgba(0,0,0,0.15), 0 4px 0 rgba(0,0,0,0.1);
  border: 3px solid transparent;
  min-height: 140px;
}

.game-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 12px 30px rgba(0,0,0,0.2), 0 6px 0 rgba(0,0,0,0.1);
}

.game-card:active {
  transform: scale(0.95);
}

.game-card.zoo { border-color: #FFB74D; background: linear-gradient(135deg, #FFF8E1 0%, #FFECB3 100%); }
.game-card.numbers { border-color: #64B5F6; background: linear-gradient(135deg, #E3F2FD 0%, #BBDEFB 100%); }
.game-card.geo { border-color: #81C784; background: linear-gradient(135deg, #E8F5E9 0%, #C8E6C9 100%); }

.game-icon {
  font-size: clamp(2.5rem, 10vw, 3.5rem);
  animation: bounce 2s ease-in-out infinite;
}

.game-card:nth-child(2) .game-icon { animation-delay: 0.3s; }
.game-card:nth-child(3) .game-icon { animation-delay: 0.6s; }

@keyframes bounce {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-8px); }
}

.game-title {
  font-family: var(--font-fun);
  font-size: clamp(1rem, 4vw, 1.3rem);
  color: #333;
  text-align: center;
}

.game-desc {
  font-size: clamp(0.7rem, 2.5vw, 0.85rem);
  color: #666;
  text-align: center;
}

.game-plays {
  font-size: 0.7rem;
  color: #999;
  display: flex;
  align-items: center;
  gap: 3px;
}

/* Selector de dificultad */
.diff-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 10px;
  margin-top: 10px;
}

.diff-label {
  font-family: 'Patrick Hand', cursive;
  font-size: clamp(1rem, 3.5vw, 1.2rem);
  color: white;
}

.diff-switch {
  display: flex;
  gap: 10px;
  background: rgba(255,255,255,0.2);
  padding: 5px;
  border-radius: 30px;
}

.diff-btn {
  padding: 12px 24px;
  border-radius: 25px;
  border: none;
  background: transparent;
  color: white;
  font-family: var(--font-fun);
  font-size: clamp(0.9rem, 3.5vw, 1.1rem);
  min-height: 48px;
  cursor: pointer;
  transition: all 0.3s;
}

.diff-btn.selected {
  background: white;
  color: var(--secondary);
  box-shadow: 0 4px 15px rgba(0,0,0,0.2);
}

.diff-btn:active {
  transform: scale(0.95);
}

/* Indicador de dificultad actual */
.current-diff-indicator {
  position: absolute;
  top: calc(15px + var(--safe-top));
  right: 15px;
  background: rgba(255,255,255,0.9);
  padding: 8px 15px;
  border-radius: 20px;
  font-family: var(--font-fun);
  font-size: 0.8rem;
  color: #333;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

/* ========================================
   PANTALLA 3: JUEGO
   ======================================== */
#game {
  background: var(--bg-grad);
  padding: 10px;
  padding-top: calc(10px + var(--safe-top));
}

#top-bar {
  width: 100%;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 5px 0;
  z-index: 20;
  flex-shrink: 0;
}

.back-btn {
  font-size: 1.3rem;
  background: rgba(255,255,255,0.2);
  border: none;
  width: 48px;
  height: 48px;
  border-radius: 50%;
  color: white;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: background 0.2s;
}

.back-btn:active {
  background: rgba(255,255,255,0.4);
}

.game-info {
  display: flex;
  align-items: center;
  gap: 10px;
}

.diff-badge {
  background: rgba(255,255,255,0.2);
  padding: 5px 12px;
  border-radius: 15px;
  font-size: 0.75rem;
  color: white;
  font-weight: bold;
}

#progress-bar {
  display: flex;
  gap: 4px;
  height: 30px;
  align-items: center;
  flex-wrap: wrap;
  justify-content: flex-end;
}

.star {
  font-size: clamp(1.2rem, 4vw, 1.5rem);
  color: rgba(255,255,255,0.3);
  transition: 0.3s;
}

.star.active {
  color: var(--primary);
  transform: scale(1.3);
  text-shadow: 0 0 10px var(--primary);
  animation: starPop 0.5s ease-out;
}

@keyframes starPop {
  0% { transform: scale(0); }
  50% { transform: scale(1.5); }
  100% { transform: scale(1.3); }
}

/* --- TUTORIAL OVERLAY --- */
.tutorial-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.8);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 100;
  padding: 20px;
}

.tutorial-overlay.active {
  display: flex;
  animation: fadeIn 0.3s;
}

.tutorial-box {
  background: white;
  border-radius: 25px;
  padding: 30px;
  max-width: 350px;
  text-align: center;
  box-shadow: 0 10px 40px rgba(0,0,0,0.3);
}

.tutorial-icon {
  font-size: 4rem;
  margin-bottom: 15px;
}

.tutorial-title {
  font-family: var(--font-fun);
  font-size: 1.5rem;
  color: #333;
  margin-bottom: 15px;
}

.tutorial-text {
  font-size: 1rem;
  color: #666;
  line-height: 1.5;
  margin-bottom: 20px;
}

.tutorial-steps {
  text-align: left;
  margin-bottom: 20px;
}

.tutorial-step {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 10px;
  font-size: 0.95rem;
}

.step-num {
  background: var(--blue);
  color: white;
  width: 28px;
  height: 28px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-family: var(--font-fun);
  font-size: 0.9rem;
  flex-shrink: 0;
}

.tutorial-btn {
  background: var(--accent);
  color: white;
  padding: 15px 40px;
  border: none;
  border-radius: 30px;
  font-family: var(--font-fun);
  font-size: 1.1rem;
  cursor: pointer;
  box-shadow: 0 4px 0 #00C853;
}

.tutorial-btn:active {
  transform: translateY(2px);
  box-shadow: 0 2px 0 #00C853;
}

/* --- MEMORY STYLES --- */
#memory-area {
  display: none;
  width: 100%;
  flex-direction: column;
  align-items: center;
  flex: 1;
  justify-content: center;
  overflow: hidden;
}

.grid {
  display: grid;
  gap: 8px;
  padding: 5px;
  width: 100%;
  max-width: 500px;
  justify-content: center;
  max-height: calc(100dvh - 150px);
}

.card {
  aspect-ratio: 1/1;
  position: relative;
  transform-style: preserve-3d;
  transition: transform 0.6s;
  min-width: 60px;
  min-height: 60px;
  cursor: pointer;
}

.card.flipped { transform: rotateY(180deg); }

.face {
  position: absolute;
  width: 100%;
  height: 100%;
  backface-visibility: hidden;
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: clamp(1.5rem, 8vw, 3rem);
  border: 3px solid white;
  background: white;
  box-shadow: 0 4px 0 rgba(0,0,0,0.2);
}

.front {
  transform: rotateY(0deg);
  background: linear-gradient(135deg, #f5f5f5 0%, #e0e0e0 100%);
}

.back {
  transform: rotateY(180deg);
  color: #333;
}

.card.matched .back {
  background: #fffde7;
  border-color: var(--accent);
  animation: matchPop 0.4s;
}

@keyframes matchPop {
  0% { transform: rotateY(180deg) scale(1); }
  50% { transform: rotateY(180deg) scale(1.1); }
  100% { transform: rotateY(180deg) scale(1); }
}

/* --- PALABRA BILING√úE (VOCABULARY POPUP) --- */
.vocab-popup {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%) scale(0);
  background: white;
  border-radius: 20px;
  padding: 20px 30px;
  text-align: center;
  box-shadow: 0 10px 40px rgba(0,0,0,0.4);
  z-index: 90;
  pointer-events: none;
  opacity: 0;
  transition: transform 0.3s, opacity 0.3s;
}

.vocab-popup.show {
  transform: translate(-50%, -50%) scale(1);
  opacity: 1;
}

.vocab-emoji {
  font-size: 3rem;
  margin-bottom: 10px;
}

.vocab-spanish {
  font-family: var(--font-fun);
  font-size: 1.5rem;
  color: #1976D2;
  margin-bottom: 5px;
}

.vocab-english {
  font-family: var(--font-fun);
  font-size: 1.3rem;
  color: #43A047;
}

.vocab-flag {
  display: flex;
  justify-content: center;
  gap: 10px;
  margin-top: 8px;
  font-size: 1.2rem;
}

/* --- GEO STYLES --- */
#geo-area {
  display: none;
  width: 100%;
  height: 100%;
  flex-direction: column;
  flex: 1;
  overflow: hidden;
}

.flags-container {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  justify-content: center;
  align-content: center;
  flex: 1;
  padding: 10px;
  background: rgba(0,0,0,0.1);
  border-radius: 20px;
  margin-bottom: 10px;
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
}

.flag-box {
  width: clamp(70px, 22vw, 90px);
  height: clamp(85px, 28vw, 110px);
  background: rgba(255,255,255,0.2);
  border: 3px solid rgba(255,255,255,0.5);
  border-radius: 15px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  transition: 0.3s;
  position: relative;
  cursor: pointer;
  min-width: 70px;
  min-height: 85px;
}

.flag-emoji {
  font-size: clamp(2rem, 8vw, 3.5rem);
  transition: 0.3s;
  filter: drop-shadow(0 2px 2px rgba(0,0,0,0.3));
}

.flag-label {
  font-size: clamp(0.55rem, 2vw, 0.7rem);
  color: white;
  font-weight: bold;
  text-transform: uppercase;
  margin-top: 3px;
  text-shadow: 1px 1px 1px black;
  text-align: center;
  padding: 0 2px;
}

.flag-box.shake { animation: shake 0.4s; border-color: var(--secondary); }
.flag-box.solved { background: white; border-color: var(--accent); transform: scale(1.05); }
.flag-box.solved .flag-emoji { transform: scale(0.6) translateY(-15px); opacity: 0.5; }
.flag-box.solved .solved-text { display: block; animation: pop 0.5s; }

.solved-text {
  display: none;
  position: absolute;
  bottom: 8px;
  width: 100%;
  text-align: center;
  color: #333;
  font-family: var(--font-fun);
  font-size: clamp(0.7rem, 2.5vw, 0.9rem);
  line-height: 1;
  padding: 0 2px;
}

.names-container {
  min-height: 120px;
  background: rgba(255,255,255,0.15);
  border-radius: 25px 25px 0 0;
  backdrop-filter: blur(10px);
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  justify-content: center;
  padding: 15px;
  padding-bottom: calc(15px + var(--safe-bottom));
  align-items: flex-start;
  align-content: flex-start;
  flex-shrink: 0;
}

.name-btn {
  background: white;
  border-radius: 30px;
  padding: 10px 16px;
  font-family: var(--font-fun);
  font-size: clamp(0.9rem, 3.5vw, 1.2rem);
  color: #333;
  box-shadow: 0 4px 0 rgba(0,0,0,0.2);
  border: 3px solid white;
  transition: 0.2s;
  cursor: pointer;
  min-height: 44px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.name-btn.selected {
  transform: scale(1.05);
  background: #FFF9C4;
  border-color: var(--primary);
  box-shadow: 0 0 15px var(--primary);
  color: black;
}

.name-btn.hidden {
  opacity: 0;
  pointer-events: none;
  transform: scale(0);
  position: absolute;
}

@keyframes shake { 0%,100%{transform:translateX(0)} 25%{transform:translateX(-5px)} 75%{transform:translateX(5px)} }
@keyframes pop { 0%{transform:scale(0)} 70%{transform:scale(1.2)} 100%{transform:scale(1)} }

/* ========================================
   PANTALLA 4: RESUMEN
   ======================================== */
#summary {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
  text-align: center;
  color: white;
  gap: 15px;
  padding: 20px;
  overflow-y: auto;
}

.summary-header {
  margin-bottom: 10px;
}

.summary-trophy {
  font-size: clamp(4rem, 15vw, 6rem);
  animation: trophyBounce 1s ease-out;
}

@keyframes trophyBounce {
  0% { transform: scale(0) rotate(-20deg); }
  60% { transform: scale(1.2) rotate(10deg); }
  100% { transform: scale(1) rotate(0deg); }
}

.summary-title {
  font-family: var(--font-fun);
  font-size: clamp(1.8rem, 7vw, 2.5rem);
  text-shadow: 3px 3px 0 rgba(0,0,0,0.2);
  margin-bottom: 5px;
}

.summary-subtitle {
  font-family: 'Patrick Hand', cursive;
  font-size: clamp(1rem, 4vw, 1.3rem);
  opacity: 0.9;
}

/* Estrellas conseguidas */
.summary-stars {
  display: flex;
  justify-content: center;
  gap: 10px;
  margin: 15px 0;
}

.summary-star {
  font-size: clamp(2rem, 8vw, 3rem);
  animation: starAppear 0.5s ease-out backwards;
}

.summary-star:nth-child(1) { animation-delay: 0.2s; }
.summary-star:nth-child(2) { animation-delay: 0.4s; }
.summary-star:nth-child(3) { animation-delay: 0.6s; }
.summary-star:nth-child(4) { animation-delay: 0.8s; }
.summary-star:nth-child(5) { animation-delay: 1s; }
.summary-star:nth-child(6) { animation-delay: 1.2s; }

@keyframes starAppear {
  0% { transform: scale(0) rotate(-180deg); opacity: 0; }
  100% { transform: scale(1) rotate(0deg); opacity: 1; }
}

/* Palabras aprendidas */
.summary-words-title {
  font-family: var(--font-fun);
  font-size: clamp(1rem, 4vw, 1.3rem);
  margin-bottom: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}

.summary-words-container {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  justify-content: center;
  max-width: 400px;
  margin: 0 auto 20px;
}

.summary-word {
  background: rgba(255,255,255,0.2);
  border-radius: 15px;
  padding: 10px 15px;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 3px;
  animation: wordSlide 0.5s ease-out backwards;
}

.summary-word:nth-child(1) { animation-delay: 0.3s; }
.summary-word:nth-child(2) { animation-delay: 0.4s; }
.summary-word:nth-child(3) { animation-delay: 0.5s; }
.summary-word:nth-child(4) { animation-delay: 0.6s; }
.summary-word:nth-child(5) { animation-delay: 0.7s; }
.summary-word:nth-child(6) { animation-delay: 0.8s; }

@keyframes wordSlide {
  0% { transform: translateY(20px); opacity: 0; }
  100% { transform: translateY(0); opacity: 1; }
}

.summary-word-emoji {
  font-size: 1.8rem;
}

.summary-word-es {
  font-family: var(--font-fun);
  font-size: 0.85rem;
  color: #FFF59D;
}

.summary-word-en {
  font-size: 0.75rem;
  color: rgba(255,255,255,0.8);
}

/* Mensaje motivacional */
.summary-message {
  background: rgba(255,255,255,0.15);
  border-radius: 20px;
  padding: 15px 20px;
  margin-bottom: 15px;
  max-width: 350px;
}

.summary-message-text {
  font-family: 'Patrick Hand', cursive;
  font-size: clamp(1rem, 4vw, 1.2rem);
  line-height: 1.4;
}

/* Botones de acci√≥n */
.summary-buttons {
  display: flex;
  flex-direction: column;
  gap: 12px;
  width: 100%;
  max-width: 300px;
}

.summary-btn {
  padding: 15px 30px;
  border-radius: 30px;
  border: none;
  font-family: var(--font-fun);
  font-size: clamp(1rem, 4vw, 1.2rem);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  min-height: 54px;
  transition: transform 0.2s;
}

.summary-btn:active {
  transform: scale(0.95);
}

.summary-btn.primary {
  background: white;
  color: var(--secondary);
  box-shadow: 0 4px 0 rgba(0,0,0,0.2);
}

.summary-btn.secondary {
  background: rgba(255,255,255,0.2);
  color: white;
  border: 2px solid white;
}

/* --- CONFETI --- */
.confetti-container {
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 200;
  overflow: hidden;
}

.confetti {
  position: absolute;
  width: 10px;
  height: 10px;
  top: -10px;
  animation: confettiFall linear forwards;
}

@keyframes confettiFall {
  0% { transform: translateY(0) rotate(0deg); opacity: 1; }
  100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
}

/* --- RESPONSIVE --- */
@media screen and (max-height: 600px) {
  .portada-image {
    max-height: 75vh;
  }
  
  .play-btn-portada {
    bottom: 5%;
    padding: 12px 35px;
  }
  
  .games-grid {
    gap: 10px;
  }
  
  .game-card {
    padding: 15px 10px;
    min-height: 120px;
  }
  
  .summary-words-container {
    max-height: 150px;
    overflow-y: auto;
  }
}

@media screen and (min-width: 600px) and (max-width: 1024px) {
  .games-grid {
    max-width: 600px;
  }
  
  .game-card {
    padding: 25px 20px;
  }
}

@media screen and (max-height: 500px) and (orientation: landscape) {
  #menu {
    flex-direction: row;
    flex-wrap: wrap;
    justify-content: center;
    gap: 15px;
  }
  
  .menu-header {
    width: 100%;
  }
  
  .games-grid {
    flex-direction: row;
    max-width: none;
  }
  
  #geo-area {
    flex-direction: row;
  }
  
  .flags-container {
    flex: 2;
    margin-bottom: 0;
    margin-right: 10px;
  }
  
  .names-container {
    flex: 1;
    border-radius: 20px;
    min-height: auto;
    height: 100%;
    flex-direction: column;
    padding-bottom: 15px;
  }
  
  #summary {
    flex-direction: row;
    flex-wrap: wrap;
    justify-content: center;
  }
  
  .summary-header {
    width: 40%;
  }
}

@media (prefers-reduced-motion: reduce) {
  *, *::before, *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
  
  .particle {
    display: none;
  }
}
</style>
</head>
<body>

<div id="bgParticles"></div>

<!-- PANTALLA 1: PORTADA -->
<div id="portada" class="screen active">
  <div class="portada-container">
    <img src="portada.png" alt="Sof√≠a y Noa - Buscad los Animales, los N√∫meros y el Mundo" class="portada-image">
    <button class="play-btn-portada" onclick="goToMenu()" aria-label="Empezar la aventura">
      ¬°JUGAR! ‚úàÔ∏è
    </button>
  </div>
</div>

<!-- PANTALLA 2: MEN√ö DE JUEGOS -->
<div id="menu" class="screen">
  <div class="current-diff-indicator" id="diffIndicator">üòä F√°cil</div>
  
  <div class="menu-header">
    <h1 class="menu-title">¬°Elige tu Aventura!</h1>
    <p class="menu-subtitle">¬øQu√© quieres aprender hoy?</p>
  </div>
  
  <div class="games-grid">
    <div class="game-card zoo" onclick="initGame('zoo')" role="button" tabindex="0" aria-label="Jugar El Gran Zoo">
      <div class="game-icon">ü¶Å</div>
      <div class="game-title">El Gran Zoo</div>
      <div class="game-desc">Encuentra los animales iguales</div>
      <div class="game-plays" id="zooPlays">üéÆ 0 veces</div>
    </div>
    
    <div class="game-card numbers" onclick="initGame('numbers')" role="button" tabindex="0" aria-label="Jugar N√∫meros">
      <div class="game-icon">üî¢</div>
      <div class="game-title">N√∫meros</div>
      <div class="game-desc">Aprende a contar jugando</div>
      <div class="game-plays" id="numbersPlays">üéÆ 0 veces</div>
    </div>
    
    <div class="game-card geo" onclick="initGame('geo')" role="button" tabindex="0" aria-label="Jugar Capitales">
      <div class="game-icon">‚úàÔ∏è</div>
      <div class="game-title">Capitales</div>
      <div class="game-desc">Viaja por el mundo</div>
      <div class="game-plays" id="geoPlays">üéÆ 0 veces</div>
    </div>
  </div>
  
  <div class="diff-container">
    <span class="diff-label">Nivel de dificultad:</span>
    <div class="diff-switch" role="group" aria-label="Selecci√≥n de dificultad">
      <button class="diff-btn selected" id="btnEasy" onclick="setDiff('easy')" aria-pressed="true">üòä F√°cil</button>
      <button class="diff-btn" id="btnHard" onclick="setDiff('hard')" aria-pressed="false">‚ö° Reto</button>
    </div>
  </div>
</div>

<!-- TUTORIAL OVERLAY -->
<div class="tutorial-overlay" id="tutorialOverlay">
  <div class="tutorial-box">
    <div class="tutorial-icon">üó∫Ô∏è</div>
    <h2 class="tutorial-title">¬øC√≥mo jugar?</h2>
    <p class="tutorial-text">¬°Vamos a viajar por el mundo!</p>
    <div class="tutorial-steps">
      <div class="tutorial-step">
        <span class="step-num">1</span>
        <span>Toca una <strong>capital</strong> de abajo</span>
      </div>
      <div class="tutorial-step">
        <span class="step-num">2</span>
        <span>Luego toca la <strong>bandera</strong> de su pa√≠s</span>
      </div>
      <div class="tutorial-step">
        <span class="step-num">3</span>
        <span>¬°Encuentra todas las parejas!</span>
      </div>
    </div>
    <button class="tutorial-btn" onclick="closeTutorial()">¬°Entendido! üëç</button>
  </div>
</div>

<!-- PANTALLA 3: JUEGO -->
<div id="game" class="screen">
  <div id="top-bar">
    <button class="back-btn" onclick="goToMenu()" aria-label="Volver al men√∫">‚ùÆ</button>
    <div class="game-info">
      <span class="diff-badge" id="gameDiffBadge">üòä F√°cil</span>
      <div id="progress-bar" role="progressbar" aria-label="Progreso del juego"></div>
    </div>
  </div>

  <div id="memory-area">
    <div class="grid" id="grid" role="grid" aria-label="Tablero de memoria"></div>
  </div>

  <div id="geo-area">
    <div id="flags-box" class="flags-container" role="list" aria-label="Banderas de pa√≠ses"></div>
    <div id="names-box" class="names-container" role="list" aria-label="Nombres de capitales"></div>
  </div>
</div>

<!-- VOCABULARY POPUP -->
<div class="vocab-popup" id="vocabPopup">
  <div class="vocab-emoji" id="vocabEmoji"></div>
  <div class="vocab-spanish" id="vocabSpanish"></div>
  <div class="vocab-english" id="vocabEnglish"></div>
  <div class="vocab-flag" id="vocabFlag"></div>
</div>

<!-- PANTALLA 4: RESUMEN -->
<div id="summary" class="screen">
  <div class="summary-header">
    <div class="summary-trophy">üèÜ</div>
    <h1 class="summary-title">¬°INCRE√çBLE!</h1>
    <p class="summary-subtitle" id="summarySubtitle">Sof√≠a y Noa est√°n muy orgullosas de ti</p>
  </div>
  
  <div class="summary-stars" id="summaryStars"></div>
  
  <div class="summary-words-title">
    <span>üìö</span>
    <span>Palabras aprendidas:</span>
  </div>
  <div class="summary-words-container" id="summaryWords"></div>
  
  <div class="summary-message">
    <p class="summary-message-text" id="summaryMessage">¬°Has aprendido mucho hoy! Cada vez eres m√°s lista. üåü</p>
  </div>
  
  <div class="summary-buttons">
    <button class="summary-btn primary" onclick="playAgain()">üîÑ Jugar otra vez</button>
    <button class="summary-btn secondary" onclick="goToMenu()">üè† Volver al men√∫</button>
  </div>
</div>

<!-- CONFETTI CONTAINER -->
<div class="confetti-container" id="confettiContainer"></div>

<script>
// ========================================
// DATOS DEL JUEGO
// ========================================
const GEO_DB = [
  {country:"ESPA√ëA", flag:"üá™üá∏", capital:"MADRID", capitalEn:"MADRID"},
  {country:"FRANCIA", flag:"üá´üá∑", capital:"PAR√çS", capitalEn:"PARIS"},
  {country:"ITALIA", flag:"üáÆüáπ", capital:"ROMA", capitalEn:"ROME"},
  {country:"R. UNIDO", flag:"üá¨üáß", capital:"LONDRES", capitalEn:"LONDON"},
  {country:"ALEMANIA", flag:"üá©üá™", capital:"BERL√çN", capitalEn:"BERLIN"},
  {country:"EE.UU.", flag:"üá∫üá∏", capital:"WASHINGTON", capitalEn:"WASHINGTON"},
  {country:"JAP√ìN", flag:"üáØüáµ", capital:"TOKIO", capitalEn:"TOKYO"},
  {country:"CHINA", flag:"üá®üá≥", capital:"PEK√çN", capitalEn:"BEIJING"},
  {country:"PORTUGAL", flag:"üáµüáπ", capital:"LISBOA", capitalEn:"LISBON"},
  {country:"BRASIL", flag:"üáßüá∑", capital:"BRASILIA", capitalEn:"BRASILIA"},
  {country:"ARGENTINA", flag:"üá¶üá∑", capital:"BUENOS AIRES", capitalEn:"BUENOS AIRES"},
  {country:"M√âXICO", flag:"üá≤üáΩ", capital:"CIUDAD DE M√âXICO", capitalEn:"MEXICO CITY"},
  {country:"RUSIA", flag:"üá∑üá∫", capital:"MOSC√ö", capitalEn:"MOSCOW"},
  {country:"EGIPTO", flag:"üá™üá¨", capital:"EL CAIRO", capitalEn:"CAIRO"},
  {country:"INDIA", flag:"üáÆüá≥", capital:"NUEVA DELHI", capitalEn:"NEW DELHI"},
  {country:"GRECIA", flag:"üá¨üá∑", capital:"ATENAS", capitalEn:"ATHENS"}
];

const ZOO_DB = [
  {emoji:"ü¶Å", es:"LE√ìN", en:"LION"},
  {emoji:"üêØ", es:"TIGRE", en:"TIGER"},
  {emoji:"üêò", es:"ELEFANTE", en:"ELEPHANT"},
  {emoji:"ü¶í", es:"JIRAFA", en:"GIRAFFE"},
  {emoji:"ü¶ì", es:"CEBRA", en:"ZEBRA"},
  {emoji:"üêí", es:"MONO", en:"MONKEY"},
  {emoji:"üêÆ", es:"VACA", en:"COW"},
  {emoji:"üê∑", es:"CERDO", en:"PIG"},
  {emoji:"üêî", es:"GALLINA", en:"CHICKEN"},
  {emoji:"üê¥", es:"CABALLO", en:"HORSE"},
  {emoji:"üê∂", es:"PERRO", en:"DOG"},
  {emoji:"üê±", es:"GATO", en:"CAT"},
  {emoji:"üê≥", es:"BALLENA", en:"WHALE"},
  {emoji:"üê¨", es:"DELF√çN", en:"DOLPHIN"},
  {emoji:"üêô", es:"PULPO", en:"OCTOPUS"},
  {emoji:"üê¢", es:"TORTUGA", en:"TURTLE"},
  {emoji:"üêß", es:"PING√úINO", en:"PENGUIN"},
  {emoji:"üê∏", es:"RANA", en:"FROG"}
];

const NUM_DB = [
  {emoji:"1", es:"UNO", en:"ONE"},
  {emoji:"2", es:"DOS", en:"TWO"},
  {emoji:"3", es:"TRES", en:"THREE"},
  {emoji:"4", es:"CUATRO", en:"FOUR"},
  {emoji:"5", es:"CINCO", en:"FIVE"},
  {emoji:"6", es:"SEIS", en:"SIX"},
  {emoji:"7", es:"SIETE", en:"SEVEN"},
  {emoji:"8", es:"OCHO", en:"EIGHT"},
  {emoji:"9", es:"NUEVE", en:"NINE"},
  {emoji:"10", es:"DIEZ", en:"TEN"}
];

// ========================================
// VARIABLES DE ESTADO
// ========================================
let mode = '';
let difficulty = 'easy';
let matches = 0;
let totalMatches = 0;
let flippedCards = [];
let lockBoard = false;
let selectedNameBtn = null;
let learnedWords = [];
let currentLevelData = [];

// ========================================
// PERSISTENCIA (localStorage)
// ========================================
function loadSettings() {
  const savedDiff = localStorage.getItem('noaGameDifficulty');
  if (savedDiff) {
    difficulty = savedDiff;
    updateDifficultyUI();
  }
  updatePlayCounts();
}

function saveSettings() {
  localStorage.setItem('noaGameDifficulty', difficulty);
}

function incrementPlayCount(gameMode) {
  const key = `noaGame_${gameMode}_plays`;
  let count = parseInt(localStorage.getItem(key) || '0');
  count++;
  localStorage.setItem(key, count.toString());
  updatePlayCounts();
}

function updatePlayCounts() {
  const zooCount = localStorage.getItem('noaGame_zoo_plays') || '0';
  const numbersCount = localStorage.getItem('noaGame_numbers_plays') || '0';
  const geoCount = localStorage.getItem('noaGame_geo_plays') || '0';
  
  document.getElementById('zooPlays').textContent = `üéÆ ${zooCount} veces`;
  document.getElementById('numbersPlays').textContent = `üéÆ ${numbersCount} veces`;
  document.getElementById('geoPlays').textContent = `üéÆ ${geoCount} veces`;
}

function updateDifficultyUI() {
  document.querySelectorAll('.diff-btn').forEach(b => {
    b.classList.remove('selected');
    b.setAttribute('aria-pressed', 'false');
  });
  const btn = document.getElementById(difficulty === 'easy' ? 'btnEasy' : 'btnHard');
  btn.classList.add('selected');
  btn.setAttribute('aria-pressed', 'true');
  
  const indicator = difficulty === 'easy' ? 'üòä F√°cil' : '‚ö° Reto';
  document.getElementById('diffIndicator').textContent = indicator;
  document.getElementById('gameDiffBadge').textContent = indicator;
}

function hasSeenTutorial(gameMode) {
  return localStorage.getItem(`noaGame_tutorial_${gameMode}`) === 'true';
}

function markTutorialSeen(gameMode) {
  localStorage.setItem(`noaGame_tutorial_${gameMode}`, 'true');
}

// ========================================
// SISTEMA DE AUDIO
// ========================================
let audioCtx = null;

function initAudioContext() {
  if (!audioCtx) {
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  }
  if (audioCtx.state === 'suspended') {
    audioCtx.resume();
  }
}

function playFx(type) {
  initAudioContext();
  if (!audioCtx) return;
  
  const t = audioCtx.currentTime;
  
  if (type === 'tap') {
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.connect(gain);
    gain.connect(audioCtx.destination);
    osc.frequency.setValueAtTime(400, t);
    osc.frequency.exponentialRampToValueAtTime(600, t + 0.1);
    gain.gain.setValueAtTime(0.1, t);
    gain.gain.linearRampToValueAtTime(0, t + 0.1);
    osc.start(t);
    osc.stop(t + 0.1);
  } else if (type === 'win') {
    [523, 659, 783, 1046].forEach((f, i) => {
      const o = audioCtx.createOscillator();
      const g = audioCtx.createGain();
      o.type = 'triangle';
      o.connect(g);
      g.connect(audioCtx.destination);
      o.frequency.value = f;
      g.gain.setValueAtTime(0.08, t + i * 0.08);
      g.gain.linearRampToValueAtTime(0, t + i * 0.08 + 0.3);
      o.start(t + i * 0.08);
      o.stop(t + i * 0.08 + 0.3);
    });
  } else if (type === 'error') {
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.connect(gain);
    gain.connect(audioCtx.destination);
    osc.frequency.setValueAtTime(150, t);
    osc.frequency.linearRampToValueAtTime(100, t + 0.2);
    gain.gain.setValueAtTime(0.1, t);
    gain.gain.linearRampToValueAtTime(0, t + 0.2);
    osc.start(t);
    osc.stop(t + 0.2);
  } else if (type === 'complete') {
    const notes = [523, 659, 783, 880, 1046, 1318];
    notes.forEach((f, i) => {
      const o = audioCtx.createOscillator();
      const g = audioCtx.createGain();
      o.type = 'sine';
      o.connect(g);
      g.connect(audioCtx.destination);
      o.frequency.value = f;
      g.gain.setValueAtTime(0.1, t + i * 0.1);
      g.gain.linearRampToValueAtTime(0, t + i * 0.1 + 0.4);
      o.start(t + i * 0.1);
      o.stop(t + i * 0.1 + 0.4);
    });
  }
}

// ========================================
// NAVEGACI√ìN ENTRE PANTALLAS
// ========================================
function showScreen(screenId) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(screenId).classList.add('active');
}

function goToMenu() {
  playFx('tap');
  showScreen('menu');
}

function goHome() {
  playFx('tap');
  showScreen('portada');
}

// ========================================
// CONFIGURACI√ìN DE DIFICULTAD
// ========================================
function setDiff(d) {
  initAudioContext();
  playFx('tap');
  difficulty = d;
  saveSettings();
  updateDifficultyUI();
}

// ========================================
// TUTORIAL
// ========================================
function showTutorial() {
  document.getElementById('tutorialOverlay').classList.add('active');
}

function closeTutorial() {
  playFx('tap');
  document.getElementById('tutorialOverlay').classList.remove('active');
  markTutorialSeen('geo');
}

// ========================================
// INICIAR JUEGO
// ========================================
function initGame(m) {
  initAudioContext();
  playFx('tap');
  mode = m;
  learnedWords = [];
  currentLevelData = [];
  incrementPlayCount(m);
  
  showScreen('game');
  
  // Mostrar tutorial para geo si es la primera vez
  if (m === 'geo' && !hasSeenTutorial('geo')) {
    setTimeout(showTutorial, 500);
  }
  
  setupLevel();
}

function playAgain() {
  playFx('tap');
  learnedWords = [];
  showScreen('game');
  setupLevel();
}

function setupLevel() {
  matches = 0;
  document.getElementById('progress-bar').innerHTML = "";
  document.getElementById('memory-area').style.display = 'none';
  document.getElementById('geo-area').style.display = 'none';

  if (mode === 'geo') {
    setupGeo();
  } else {
    setupMemory();
  }
}

// ========================================
// POPUP DE VOCABULARIO
// ========================================
function showVocabPopup(emoji, spanish, english, isGeo = false) {
  const popup = document.getElementById('vocabPopup');
  document.getElementById('vocabEmoji').textContent = emoji;
  document.getElementById('vocabSpanish').textContent = spanish;
  document.getElementById('vocabEnglish').textContent = english;
  
  // Mostrar banderas de idioma
  const flagDiv = document.getElementById('vocabFlag');
  if (isGeo) {
    flagDiv.innerHTML = 'üåç';
  } else {
    flagDiv.innerHTML = 'üá™üá∏ üá¨üáß';
  }
  
  popup.classList.add('show');
  
  // Vibraci√≥n suave si est√° disponible
  if (navigator.vibrate) {
    navigator.vibrate(50);
  }
  
  setTimeout(() => {
    popup.classList.remove('show');
  }, 2000);
}

// ========================================
// L√ìGICA MEMORY
// ========================================
function setupMemory() {
  document.getElementById('memory-area').style.display = 'flex';
  const grid = document.getElementById('grid');
  grid.innerHTML = "";
  flippedCards = [];
  lockBoard = false;
  
  const numPairs = difficulty === 'easy' ? 3 : 6;
  totalMatches = numPairs;
  
  for (let i = 0; i < numPairs; i++) {
    addStar();
  }

  const source = mode === 'zoo' ? ZOO_DB : NUM_DB;
  let items = [...source].sort(() => Math.random() - 0.5).slice(0, numPairs);
  currentLevelData = items;
  
  let deck = [...items, ...items].sort(() => Math.random() - 0.5);
  
  const cols = difficulty === 'easy' ? 3 : 4;
  grid.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;

  deck.forEach((item, index) => {
    const card = document.createElement('div');
    card.className = 'card';
    card.setAttribute('role', 'button');
    card.setAttribute('tabindex', '0');
    card.setAttribute('aria-label', `Carta ${index + 1}`);
    card.innerHTML = `<div class="face front" aria-hidden="true">‚ùì</div><div class="face back" aria-hidden="true">${item.emoji}</div>`;
    card.dataset.itemEs = item.es;
    card.dataset.itemEn = item.en;
    card.dataset.itemEmoji = item.emoji;
    card.onclick = () => flipCard(card, item);
    card.onkeydown = (e) => {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        flipCard(card, item);
      }
    };
    grid.appendChild(card);
  });
}

function flipCard(card, item) {
  if (lockBoard || card.classList.contains('flipped')) return;
  playFx('tap');
  card.classList.add('flipped');
  card.setAttribute('aria-label', `Carta volteada: ${item.es}`);
  flippedCards.push({el: card, item: item});

  if (flippedCards.length === 2) {
    lockBoard = true;
    if (flippedCards[0].item.emoji === flippedCards[1].item.emoji) {
      // ¬°Match!
      playFx('win');
      flippedCards.forEach(c => {
        c.el.classList.add('matched');
        c.el.setAttribute('aria-label', `Pareja encontrada: ${item.es}`);
      });
      
      // Mostrar vocabulario
      showVocabPopup(item.emoji, item.es, item.en);
      
      // Guardar palabra aprendida
      if (!learnedWords.find(w => w.emoji === item.emoji)) {
        learnedWords.push({emoji: item.emoji, es: item.es, en: item.en});
      }
      
      flippedCards = [];
      lockBoard = false;
      addScore();
    } else {
      setTimeout(() => {
        flippedCards.forEach(c => {
          c.el.classList.remove('flipped');
          c.el.setAttribute('aria-label', 'Carta oculta');
        });
        flippedCards = [];
        lockBoard = false;
      }, 1000);
    }
  }
}

// ========================================
// L√ìGICA GEO (TAP & MATCH)
// ========================================
function setupGeo() {
  document.getElementById('geo-area').style.display = 'flex';
  const flagBox = document.getElementById('flags-box');
  const nameBox = document.getElementById('names-box');
  flagBox.innerHTML = "";
  nameBox.innerHTML = "";
  selectedNameBtn = null;

  const count = difficulty === 'easy' ? 3 : 6;
  totalMatches = count;
  
  for (let i = 0; i < count; i++) {
    addStar();
  }

  let levelData = [...GEO_DB].sort(() => Math.random() - 0.5).slice(0, count);
  currentLevelData = levelData;

  // Crear banderas
  levelData.forEach(item => {
    const box = document.createElement('div');
    box.className = 'flag-box';
    box.dataset.capital = item.capital;
    box.dataset.capitalEn = item.capitalEn;
    box.dataset.country = item.country;
    box.dataset.flag = item.flag;
    box.setAttribute('role', 'listitem');
    box.setAttribute('tabindex', '0');
    box.setAttribute('aria-label', `Bandera de ${item.country}. Toca para emparejar con su capital.`);
    box.innerHTML = `
      <div class="flag-emoji" aria-hidden="true">${item.flag}</div>
      <div class="flag-label" aria-hidden="true">${item.country}</div>
      <div class="solved-text" aria-hidden="true">${item.capital}</div>
    `;
    box.onclick = () => handleFlagClick(box);
    box.onkeydown = (e) => {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        handleFlagClick(box);
      }
    };
    flagBox.appendChild(box);
  });

  // Crear botones de nombres (barajados)
  let names = [...levelData].sort(() => Math.random() - 0.5);
  names.forEach(item => {
    const btn = document.createElement('div');
    btn.className = 'name-btn';
    btn.setAttribute('role', 'listitem');
    btn.setAttribute('tabindex', '0');
    btn.setAttribute('aria-label', `Capital: ${item.capital}. Toca para seleccionar.`);
    btn.innerText = item.capital;
    btn.dataset.capitalEn = item.capitalEn;
    btn.onclick = () => handleNameClick(btn);
    btn.onkeydown = (e) => {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        handleNameClick(btn);
      }
    };
    nameBox.appendChild(btn);
  });
}

function handleNameClick(btn) {
  playFx('tap');
  if (selectedNameBtn) {
    selectedNameBtn.classList.remove('selected');
    selectedNameBtn.setAttribute('aria-selected', 'false');
  }
  
  selectedNameBtn = btn;
  btn.classList.add('selected');
  btn.setAttribute('aria-selected', 'true');
}

function handleFlagClick(box) {
  if (!selectedNameBtn || box.classList.contains('solved')) {
    if (!box.classList.contains('solved')) {
      playFx('error');
    }
    return;
  }

  if (box.dataset.capital === selectedNameBtn.innerText) {
    // ¬°Acierto!
    playFx('win');
    box.classList.add('solved');
    box.setAttribute('aria-label', `${box.dataset.country} - Capital: ${box.dataset.capital}. ¬°Correcto!`);
    
    // Mostrar vocabulario
    showVocabPopup(box.dataset.flag, box.dataset.capital, box.dataset.capitalEn, true);
    
    // Guardar palabra aprendida
    learnedWords.push({
      emoji: box.dataset.flag,
      es: box.dataset.capital,
      en: box.dataset.capitalEn
    });
    
    selectedNameBtn.classList.add('hidden');
    selectedNameBtn.setAttribute('aria-hidden', 'true');
    selectedNameBtn = null;
    addScore();
  } else {
    // Error
    playFx('error');
    box.classList.add('shake');
    setTimeout(() => box.classList.remove('shake'), 500);
  }
}

// ========================================
// SISTEMA DE PUNTUACI√ìN
// ========================================
function addStar() {
  const s = document.createElement('div');
  s.className = 'star';
  s.innerHTML = '‚≠ê';
  s.setAttribute('aria-hidden', 'true');
  document.getElementById('progress-bar').appendChild(s);
}

function addScore() {
  const stars = document.querySelectorAll('#progress-bar .star');
  if (stars[matches]) {
    stars[matches].classList.add('active');
  }
  matches++;
  
  const progressBar = document.getElementById('progress-bar');
  progressBar.setAttribute('aria-valuenow', matches);
  progressBar.setAttribute('aria-valuemax', totalMatches);
  
  if (matches === totalMatches) {
    setTimeout(() => {
      showSummary();
    }, 1500);
  }
}

// ========================================
// PANTALLA DE RESUMEN
// ========================================
function showSummary() {
  playFx('complete');
  
  // Generar estrellas
  const starsContainer = document.getElementById('summaryStars');
  starsContainer.innerHTML = '';
  for (let i = 0; i < totalMatches; i++) {
    const star = document.createElement('span');
    star.className = 'summary-star';
    star.textContent = '‚≠ê';
    starsContainer.appendChild(star);
  }
  
  // Generar palabras aprendidas
  const wordsContainer = document.getElementById('summaryWords');
  wordsContainer.innerHTML = '';
  learnedWords.forEach(word => {
    const wordEl = document.createElement('div');
    wordEl.className = 'summary-word';
    wordEl.innerHTML = `
      <span class="summary-word-emoji">${word.emoji}</span>
      <span class="summary-word-es">${word.es}</span>
      <span class="summary-word-en">${word.en}</span>
    `;
    wordsContainer.appendChild(wordEl);
  });
  
  // Mensaje motivacional aleatorio
  const messages = [
    "¬°Has aprendido mucho hoy! Cada vez eres m√°s lista. üåü",
    "¬°Sof√≠a y Noa est√°n muy orgullosas de ti! üíñ",
    "¬°Eres una campeona del aprendizaje! üéâ",
    "¬°Qu√© bien lo has hecho! Sigue as√≠. ‚ú®",
    "¬°Incre√≠ble! Has aprendido " + learnedWords.length + " palabras nuevas. üìö"
  ];
  document.getElementById('summaryMessage').textContent = messages[Math.floor(Math.random() * messages.length)];
  
  // Subt√≠tulo seg√∫n el modo
  const subtitles = {
    'zoo': '¬°Ya conoces muchos animales!',
    'numbers': '¬°Los n√∫meros son tus amigos!',
    'geo': '¬°Eres una gran exploradora!'
  };
  document.getElementById('summarySubtitle').textContent = subtitles[mode] || 'Sof√≠a y Noa est√°n muy orgullosas de ti';
  
  showScreen('summary');
  
  // Lanzar confeti
  setTimeout(launchConfetti, 300);
}

// ========================================
// EFECTOS VISUALES
// ========================================
function launchConfetti() {
  const container = document.getElementById('confettiContainer');
  container.innerHTML = '';
  
  const colors = ['#FFD700', '#FF4500', '#00E676', '#4FC3F7', '#FF80AB', '#B388FF'];
  const shapes = ['circle', 'square'];
  
  for (let i = 0; i < 50; i++) {
    const confetti = document.createElement('div');
    confetti.className = 'confetti';
    confetti.style.left = Math.random() * 100 + '%';
    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
    confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
    confetti.style.animationDelay = Math.random() * 0.5 + 's';
    
    if (shapes[Math.floor(Math.random() * shapes.length)] === 'square') {
      confetti.style.borderRadius = '2px';
    }
    
    container.appendChild(confetti);
  }
  
  // Limpiar confeti despu√©s de la animaci√≥n
  setTimeout(() => {
    container.innerHTML = '';
  }, 4000);
}

function initParticles() {
  const bg = document.getElementById('bgParticles');
  bg.innerHTML = '';
  
  const particleCount = window.innerWidth < 600 ? 10 : 20;
  const emojis = ['‚≠ê', '‚ú®', 'üí´', 'üåü', 'üéà', 'üéÄ', 'üíñ', 'ü¶ã'];
  
  for (let i = 0; i < particleCount; i++) {
    const p = document.createElement('div');
    p.className = 'particle';
    p.textContent = emojis[Math.floor(Math.random() * emojis.length)];
    p.style.left = Math.random() * 100 + '%';
    p.style.top = Math.random() * 100 + '%';
    p.style.fontSize = (Math.random() * 15 + 10) + 'px';
    p.style.animationDuration = (Math.random() * 15 + 10) + 's';
    p.style.animationDelay = Math.random() * 5 + 's';
    bg.appendChild(p);
  }
}

// ========================================
// PREVENCI√ìN DE COMPORTAMIENTOS M√ìVILES
// ========================================
function preventMobileIssues() {
  // Prevenir zoom con doble tap
  let lastTouchEnd = 0;
  document.addEventListener('touchend', function(event) {
    const now = Date.now();
    if (now - lastTouchEnd <= 300) {
      event.preventDefault();
    }
    lastTouchEnd = now;
  }, { passive: false });
  
  // Prevenir scroll en iOS Safari (excepto en contenedores scrollables)
  document.addEventListener('touchmove', function(e) {
    if (e.target.closest('.flags-container') || e.target.closest('.summary-words-container') || e.target.closest('#summary')) {
      return;
    }
    e.preventDefault();
  }, { passive: false });
  
  // Manejar cambios de orientaci√≥n
  window.addEventListener('orientationchange', function() {
    setTimeout(() => {
      window.scrollTo(0, 0);
    }, 100);
  });
}

// ========================================
// SOPORTE PARA TECLADO
// ========================================
function initKeyboardSupport() {
  document.querySelectorAll('.game-card, .menu-card').forEach(card => {
    card.addEventListener('keydown', function(e) {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        this.click();
      }
    });
  });
}

// ========================================
// INICIALIZACI√ìN
// ========================================
document.addEventListener('DOMContentLoaded', function() {
  loadSettings();
  initParticles();
  preventMobileIssues();
  initKeyboardSupport();
});
</script>
</body>
</html>
